<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Review</title>
  <meta name="comp1800 template" content="my bcit Hiking App project">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

 

  <!-- Boostrap JS CDN -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <!-- Firebase 8 related CSS CDN -->

  <!-- Firebase 8 related JS CDN -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Link to the api keys for your Firebase project -->
  <script src="./scripts/firebaseAPI_team01.js"></script>
  <script src="jquery.js"></script>


  <script src="./scripts/my_script.js"></script>



  <!-- fontawesome -->
  <script src="https://kit.fontawesome.com/2e05f14c55.js" crossorigin="anonymous"></script>
  <link href="./styles/my_style.css" rel="stylesheet">


  <style>

  </style>
</head>

<body>

   
      
    <!-- Bottom Navbar -->
    <div class="offcanvas offcanvas-top" tabindex="-1" id="offcanvasTop" aria-labelledby="offcanvasTopLabel">
      <div class="offcanvas-header bg-dark">
        <button type="button" class="btn-close text-reset btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="text-center bg-dark"><h5 id="offcanvasTopLabel" class="text-warning h1 appName bg-dark">Serenity</h5>
      </div>
      <div class="offcanvas-body bg-dark text-light">
        <div class="text-center bg-dark">
        Hello <span id="navDisplay5" class="text-warning"></span>, are you feeling good today??
      </div>
      <br/>
        <div class="row align-items-start">
          <div class="col align-self-center">
            <a class="text-light" href="./index.html">
              <span class="text-warning" onclick="signOut()">Logout</span>
            </a>
          </div>
          <div class="col text-end">
            <span class="">
              <a class="text-light" href="./user.html">
                My profile
                <i class="far fa-user-circle"></i>
              </a>
            </span>
          </div>
      </div>
      </div>
    </div>

    <nav class="navbar fixed-bottom navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="./main.html">
          <i class="fas fa-home"></i>
        </a>
        <a class="navbar-brand" href="./gamemode.html">
          <i class="fas fa-gamepad"></i>
        </a>
        <a class="navbar-brand" href="./timemode.html">
          <i class="fas fa-stopwatch"></i>
        </a>
        <a class="navbar-brand" href="./record.html">
          <i class="fas fa-chart-bar"></i>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasTop" aria-controls="offcanvas-top"
          aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

      </div>
    </nav>

    <!-- Navbar end -->
    
  <!-- Container -->


  
  <div class="container-sm">
    <div class="height-90 container d-flex justify-content-center align-items-center">
      <div class="card p-3 bg-light gradient">
        <div class="title">
          <h1>Congratulation! You just completed, <br/><span id="videoTitleHere" class="text-danger"></span></h1>
          <hr class="solid">

        </div>

        <figure class="figure">
          <img src="./images/completion1.jpg" class="figure-img img-fluid rounded" alt="...">
          <figcaption class="figure-caption">Location: Berchtesgaden National Park</figcaption>
        </figure>

        <figure class="text-center">
          <blockquote class="blockquote">
            <p>The real meditation is how you live your life.</p>
          </blockquote>
          <figcaption class="blockquote-footer">
            Zenful Spirit <cite title="Source Title">Jon Kabat-Zinn</cite>
          </figcaption>
        </figure>

        <form method="POST" action="do-something.php">
          <div class="form-group">
            <label for="exampleFormControlInput1">Add your review title</label>
            <input type="text" class="form-control" id="title" placeholder="Title">
          </div><br />
          <div class="form-group">
            <label for="exampleFormControlSelect1">How difficult was the Meditation?</label>
            <select class="form-control" id="level">
              <option>Easy</option>
              <option>Moderate</option>
              <option>Hard</option>
            </select>
            <br>
          </div>
          <div class="form-group">
            <label for="exampleFormControlTextarea1">What was your experience with this Mediation?</label>
            <textarea class="form-control" id="description" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label for="exampleFormControlTextarea1">How would you rate this experience?</label>
            <div id="radiobutton">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="1">
                <label class="form-check-label" for="inlineRadio1">1</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="2">
                <label class="form-check-label" for="inlineRadio2">2</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="3">
                <label class="form-check-label" for="inlineRadio3">3</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio4" value="4">
                <label class="form-check-label" for="inlineRadio3">4</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio5" value="5">
                <label class="form-check-label" for="inlineRadio3">5</label>
              </div>
            </div>
            




          </div>
          <br>
          <div class="d-flex justify-content-evenly">
            <button type="button" class="btn btn-warning btn px-4 me-sm-3 fw-bold"
              onclick="writeReview()">Submit</button>



            <button type="button" class="btn btn-info btn px-4 me-sm-3 fw-bold"
              onclick="complete()">Return to home page</button>
          </div>
          <br>
          <br>
        </form>
      </div>
    </div>
  </div>



  <script src="./scripts/my_script.js"></script>

  <script>
    // videoID is a variable that will be saved to the local storage in the browser
    let videoID = localStorage.getItem("videoID", "value");

    // accessing the Videos collection and grabbing the video_ID
    db.collection("Videos").where("video_ID", "==", videoID)
      .get()
      .then(queryVideo => {
        // see how many results you have got from the query
        size = queryVideo.size;
        // get the documents of query
        Videos = queryVideo.docs;
        // get the Video title
        videoTitle = Videos.title;

        // We want to have one document per video, so if the the result of 
        //the query is more than one, we can check it right now and clean the DB if needed.
        if (size = 1) {
          var thisVideo = Videos[0].data();
          name = thisVideo.name;
          //document.getElementById("videoTitleHere").innerHTML = videoTitle;
        } else {
          console.log("Query has more than one data")
        }
      })
      .catch((error) => {
        console.log("Error getting documents: ", error);
      });


    /**
     * This function allows the user to write a review and then write it to the database in firebase.
     * 
    **/
    function writeReview() {
      // num is the value of the radiobutton selected by the user and parses it from a string to an int
      var num = parseInt(document.querySelector('input[name="inlineRadioOptions"]:checked').value);
      // gets the title of the review and its value
      let Title = document.getElementById("title").value;
      // gets the difficulty level of the meditation
      let Level = document.getElementById("level").value;
      // gets the description written by the user
      let Description = document.getElementById("description").value;
      // gets the date stamp of the review
      let currentdate = new Date();
      let reviewDate = currentdate.getFullYear() + "/" + (currentdate.getMonth() + 1) + "/" + currentdate.getDate();
      // gets the score and writes it to the database
      let Score = num;



      // checks the user
      firebase.auth().onAuthStateChanged(user => {
        // if user exists
        if (user) {
          // get the current user
          var currentUser = db.collection("users").doc(user.uid);
          // gets the user ID
          var userID = user.uid;
          currentUser.get()
            .then(userDoc => {
              //get user Email
              var userEmail = userDoc.data().email;
              //get user name
              var name = userDoc.data().name;
              // Start a new collection and add all data in it.
              db.collection("Reviews").add({
                video_ID: videoID,
                userID: userID,
                userEmail: userEmail,
                title: Title,
                level: Level,
                descirption: Description,
                name: name,
                score: Score,
                date: reviewDate

              });
              alertBox();


            })
        } else {
          // No user is signed in.
          console.log("no user signed in");
        }
      });
    }

    // when the user completes the review redirects the user to the main.html
    function complete() {
      window.location.replace("main.html");

    }

    function alertBox() {
        swal.fire({
            title: "Review Submitted!",
            icon: "success",
            buttons: true,
            dangerMode: true,
        })
        .then((isOkay) => {
            if (isOkay) {
                form.submit();
            }
        });
        return false;
    }


    

  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
    integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>

  <script>
    // checks if the user exists
    checkUser();
    // needs this to display title for the review page
    insertContent();
  </script>
</body>

</html>